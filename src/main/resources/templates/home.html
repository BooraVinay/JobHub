<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>


    /* Highlight style for search matches */
    .highlight {
        background-color: yellow;
        font-weight: bold;
    }
</style>

</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <img class="navbar-brand" style="width:100px;height:auto" src="/img/logo.png">

        <div class="collapse navbar-collapse" id="navbarScroll">
            <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/contactus">Contact Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/aboutus">About Us</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="/upload">Upload JOB</a>
                </li>
            </ul>
            <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" id="searchInput">
                <button class="btn btn-outline-success" type="button" onclick="handleSearch()">Search</button>
            </form>

        </div>
    </div>
</nav>
<br>
<div class="container">
    <div class="row row-cols-1 row-cols-md-3 g-4" id="jobCardsContainer" >
        <div class="col" th:each="jobPosting : ${jobPostings}">
            <div class="card h-100" >
                <h5 class="card-title">Title:</h5> <span th:text="${jobPosting['Job Title:']}" class="job-title"></span>
                <p class="card-text">Company:</p> <span th:text="${jobPosting['Company Name:']}" class="job-company"></span>
                <p class="card-text">Location:</p> <span th:text="${jobPosting['Job Location:']}"></span>
                <p class="card-text">Posting Date:</p> <span th:text="${jobPosting['Posting Date:']}"></span>
                <p class="card-text">Posting DateTime:</p> <span th:text="${jobPosting['Posting DateTime:']}"></span>
                <a th:href="${jobPosting['jobUrl']}">Details</a>
            </div>
        </div>
    </div>
</div>





<script>
function
        function customPartialMatch(fullText, partialText) {
            var regex = new RegExp(partialText, 'i');
            return regex.test(fullText);
        }

        function handleSearch() {
            var searchInput = document.getElementById('searchInput');
            var searchTerm = searchInput.value.trim().toLowerCase();
            var jobCards = document.querySelectorAll('.card');

            jobCards.forEach(function (jobCard) {
                var jobTitle = jobCard.querySelector('.job-title').textContent.toLowerCase();
                var jobCompany = jobCard.querySelector('.job-company').textContent.toLowerCase();
                var match = customPartialMatch(jobTitle, searchTerm) || customPartialMatch(jobCompany, searchTerm);
                jobCard.style.display = match ? 'block' : 'none';

                var titleSpan = jobCard.querySelector('.job-title');
                titleSpan.innerHTML = titleSpan.textContent.replace(new RegExp('(' + searchTerm + ')', 'ig'), '<span class="highlight">$1</span>');

                var companySpan = jobCard.querySelector('.job-company');
                companySpan.innerHTML = companySpan.textContent.replace(new RegExp('(' + searchTerm + ')', 'ig'), '<span class="highlight">$1</span>');
            });
        }
         function handleSort() {
            var sortOption = document.getElementById('sortOptions').value;
            var jobCardsContainer = document.getElementById('jobCardsContainer');
            var jobCards = jobCardsContainer.querySelectorAll('.card');

            var sortedJobCards = Array.from(jobCards).sort(function (a, b) {
                var dateA = getDateValue(a.querySelector('.job-date').textContent);
                var dateB = getDateValue(b.querySelector('.job-date').textContent);

                if (sortOption === 'mostRecent') {
                    return compareDates(dateB, dateA);
                } else {
                    return compareDates(dateA, dateB);
                }
            });

            // Clear current job cards and append sorted ones
            jobCardsContainer.innerHTML = '';
            sortedJobCards.forEach(function (jobCard) {
                jobCardsContainer.appendChild(jobCard.cloneNode(true));
            });
        }

        // Helper function to compare dates, handling cases where a date might be undefined
        function compareDates(dateA, dateB) {
            if (dateA && dateB) {
                return dateA - dateB;
            } else if (dateA) {
                return -1;
            } else if (dateB) {
                return 1;
            } else {
                return 0; // Both dates are undefined
            }
        }

        // Helper function to extract a date value from the job date text
        function getDateValue(dateText) {
            // Example: Assuming the date is in a simple format like "YYYY-MM-DD"
            // You may need to adjust this based on your actual date format
            var dateParts = dateText.split('-');
            if (dateParts.length === 3) {
                var year = parseInt(dateParts[0], 10);
                var month = parseInt(dateParts[1], 10);
                var day = parseInt(dateParts[2], 10);

                // Return a Date object or a numeric representation of the date
                // depending on your sorting needs
                return new Date(year, month - 1, day);
            } else {
                // Return undefined if the date format is not as expected
                return undefined;
            }
        }
    </script>
</body>

</html>
